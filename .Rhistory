# Within-cluster sum of square
withinss = .x$kmeans.obj$withinss,
# Cluster size
size = .x$kmeans.obj$size) %>%
gather(key = "Indicator", value = "Indicator_value", withinss, size) %>%
spread(key = "Cluster", value = "Indicator_value") %>%
group_by(model) %>%
mutate(Total = sum(starts_with("Cluster ")))
}) %>%
split(., .$Indicator)
clusters_info <- data.frame(model = .x$title.save,
Cluster = c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4", "Cluster 5"),
# Within-cluster sum of square
withinss = .x$kmeans.obj$withinss,
# Cluster size
size = .x$kmeans.obj$size) %>%
gather(key = "Indicator", value = "Indicator_value", withinss, size) %>%
spread(key = "Cluster", value = "Indicator_value") %>%
group_by(model) %>%
mutate(Total = sum('Cluster 1', 'Cluster 2', 'Cluster 3', 'Cluster 4', 'Cluster 5')))
# > Clusters indicators
list_for_plot %>%
map_dfr(., ~{
clusters_info <- data.frame(model = .x$title.save,
Cluster = c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4", "Cluster 5"),
# Within-cluster sum of square
withinss = .x$kmeans.obj$withinss,
# Cluster size
size = .x$kmeans.obj$size) %>%
gather(key = "Indicator", value = "Indicator_value", withinss, size) %>%
spread(key = "Cluster", value = "Indicator_value") %>%
group_by(model) %>%
mutate(Total = sum('Cluster 1', 'Cluster 2', 'Cluster 3', 'Cluster 4', 'Cluster 5')))
}) %>%
split(., .$Indicator)
# > Clusters indicators
list_for_plot %>%
map_dfr(., ~{
clusters_info <- data.frame(model = .x$title.save,
Cluster = c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4", "Cluster 5"),
# Within-cluster sum of square
withinss = .x$kmeans.obj$withinss,
# Cluster size
size = .x$kmeans.obj$size) %>%
gather(key = "Indicator", value = "Indicator_value", withinss, size) %>%
spread(key = "Cluster", value = "Indicator_value") %>%
group_by(model) %>%
mutate(Total = sum('Cluster 1', 'Cluster 2', 'Cluster 3', 'Cluster 4', 'Cluster 5'))
}) %>%
split(., .$Indicator)
# > Clusters indicators
list_for_plot %>%
map_dfr(., ~{
clusters_info <- data.frame(model = .x$title.save,
Cluster = c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4", "Cluster 5"),
# Within-cluster sum of square
withinss = .x$kmeans.obj$withinss,
# Cluster size
size = .x$kmeans.obj$size) %>%
gather(key = "Indicator", value = "Indicator_value", withinss, size) %>%
spread(key = "Cluster", value = "Indicator_value")
}) %>%
split(., .$Indicator)
# > Clusters indicators
list_for_plot %>%
map_dfr(., ~{
clusters_info <- data.frame(model = .x$title.save,
Cluster = c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4", "Cluster 5"),
# Within-cluster sum of square
withinss = .x$kmeans.obj$withinss,
# Cluster size
size = .x$kmeans.obj$size) %>%
gather(key = "Indicator", value = "Indicator_value", withinss, size) %>%
spread(key = "Cluster", value = "Indicator_value")
}) %>%
split(., .$Indicator)
# > Clusters indicators
list_for_plot %>%
map_dfr(., ~{
clusters_info <- data.frame(model = .x$title.save,
Cluster = c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4", "Cluster 5"),
# Within-cluster sum of square
withinss = .x$kmeans.obj$withinss,
# Cluster size
size = .x$kmeans.obj$size) %>%
gather(key = "Indicator", value = "Indicator_value", withinss, size)
}) %>%
split(., .$Indicator)
# > Clusters indicators
list_for_plot %>%
map_dfr(., ~{
clusters_info <- data.frame(model = .x$title.save,
Cluster = c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4", "Cluster 5"),
# Within-cluster sum of square
withinss = .x$kmeans.obj$withinss,
# Cluster size
size = .x$kmeans.obj$size) %>%
gather(key = "Indicator", value = "Indicator_value", withinss, size)
})
# > Clusters indicators
list_for_plot %>%
map_dfr(., ~{
clusters_info <- data.frame(model = .x$title.save,
Cluster = c("Cluster1", "Cluster2", "Cluster3", "Cluster4", "Cluster5"),
# Within-cluster sum of square
withinss = .x$kmeans.obj$withinss,
# Cluster size
size = .x$kmeans.obj$size) %>%
gather(key = "Indicator", value = "Indicator_value", withinss, size) %>%
spread(key = "Cluster", value = "Indicator_value") %>%
group_by(model, Indicator) %>%
mutate(Total = Cluster1 + Cluster2 + Cluster3 + Cluster4 + Cluster5)
}) %>%
split(., .$Indicator)
# > Centers coordinates
list_for_plot %>%
map(., ~{
centers_info <- cbind(model = .x$title.save,
Cluster = c("Cluster 1", "Cluster 2", "Cluster 3", "Cluster 4", "Cluster 5"),
data.frame(.x$kmeans.obj$centers)) %>%
gather(key = "var", value = "value", -Cluster) %>%
# Merge with variable names to allow for merging dataframe from different analyses
left_join(tab.name %>% mutate(var = paste0("z_", var)), by = "var") %>%
dplyr::select(-var)
})
list_for_plot <- list(
# Main analyses
list(kmeans.obj = KM.wei_log,
raw.data = data_wei_log,
data.for.kmeans = z_data_wei_log,
title.plot = "Weighted daily average (skewed variables are log(x+1))",
title.save = "01_wei_log"),
list(kmeans.obj = KM.wei_sqrt,
raw.data = data_wei_sqrt,
data.for.kmeans = z_data_wei_sqrt,
title.plot = "Weighted daily average (skewed variables are sqrt(x))",
title.save = "01_wei_sqrt"),
list(kmeans.obj = KM.WDWE_log,
raw.data = data_WD_WE_log,
data.for.kmeans = z_data_WD_WE_log,
title.plot = "Week and weekend variables (skewed variables are log(x+1))",
title.save = "02_WD_WE_log"),
list(kmeans.obj = KM.WDWE_sqrt,
raw.data = data_WD_WE_sqrt,
data.for.kmeans = z_data_WD_WE_sqrt,
title.plot = "Week and weekend variables (skewed variables are sqrt(x))",
title.save = "02_WD_WE_sqrt"),
# Sensitivity analyses
list(kmeans.obj = KM.wei_full_log,
raw.data = data_wei_full_log,
data.for.kmeans = z_data_wei_full_log,
title.plot = "Weighted daily average (skewed variables are log(x+1)) - Full set of features",
title.save = "03_wei_full_log"),
list(kmeans.obj = KM.wei_full_sqrt,
raw.data = data_wei_full_sqrt,
data.for.kmeans = z_data_wei_full_sqrt,
title.plot = "Weighted daily average (skewed variables are sqrt(x)) - Full set of features",
title.save = "03_wei_full_sqrt"),
list(kmeans.obj = KM.WDWE_full_log,
raw.data = data_WD_WE_full_log,
data.for.kmeans = z_data_WD_WE_full_log,
title.plot = "Week and weekend variables (skewed variables are log(x+1)) - Full set of features",
title.save = "04_WD_WE_full_log"),
list(kmeans.obj = KM.WDWE_full_sqrt,
raw.data = z_data_WD_WE_full_sqrt,
data.for.kmeans = z_data_WD_WE_full_sqrt,
title.plot = "Week and weekend variables (skewed variables are sqrt(x)) - Full set of features",
title.save = "04_WD_WE_full_sqrt"))
# > Difference in activity features among and between clusters
map(list_for_plot, comp_PA_feat, data = .x$raw.data)
# > Difference in activity features among and between clusters
map(.x = list_for_plot, ... = comp_PA_feat(data = .x$raw.data))
# > Difference in activity features among and between clusters
map(.x = list_for_plot, .f = comp_PA_feat(data = .x$raw.data))
# > Difference in activity features among and between clusters
map(.x = list_for_plot, .f = comp_PA_feat(data = x$raw.data))
# > Difference in activity features among and between clusters
apply(list_for_plot, FUN = comp_PA_feat,data = x$raw.data, )
# > Difference in activity features among and between clusters
lapply(list_for_plot, FUN = comp_PA_feat,data = x$raw.data, )
mapply(function, ...)
?map
# > Difference in activity features among and between clusters
list_for_plot %>% map(comp_PA_feat(data = x$raw.data))
# > Difference in activity features among and between clusters
list_for_plot %>% map(comp_PA_feat(data = .x$raw.data))
means_comp <- list(
"01_wei_log"    = comp_PA_feat(data = data_wei_log),
"01_wei_sqrt"   = comp_PA_feat(data = data_wei_sqrt),
"02_WD_WE_log"  = comp_PA_feat(data = data_WD_WE_log),
"02_WD_WE_sqrt" = comp_PA_feat(data = data_WD_WE_sqrt),
"03_wei_full_log"    = comp_PA_feat(data = data_wei_full_log),
"03_wei_full_sqrt"   = comp_PA_feat(data = data_wei_full_sqrt),
"04_WD_WE_full_log"  = comp_PA_feat(data = data_WD_WE_full_log),
"04_WD_WE_full_sqrt" = comp_PA_feat(data = data_WD_WE_full_sqrt)
)
wei_log_k_means_comp    <- comp_PA_feat(data = data_wei_log)
wei_sqrt_k_means_comp   <- comp_PA_feat(data = data_wei_sqrt)
WD_WE_log_k_means_comp  <- comp_PA_feat(data = data_WD_WE_log)
WD_WE_sqrt_k_means_comp <- comp_PA_feat(data = data_WD_WE_sqrt)
wei_full_log_k_means_comp    <- comp_PA_feat(data = data_wei_full_log)
wei_full_sqrt_k_means_comp   <- comp_PA_feat(data = data_wei_full_sqrt)
WD_WE_full_log_k_means_comp  <- comp_PA_feat(data = data_WD_WE_full_log)
WD_WE_full_sqrt_k_means_comp <- comp_PA_feat(data = data_WD_WE_full_sqrt)
wei_log_k_means_comp[[1]]
wei_log_k_means_comp[[2]]
library(xlsx)
?write.xlsx
# > Results from variance analyses (difference among clusters)
list(
title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]],
title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[1]],
title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[1]],
title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[1]],
title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[1]],
title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[1]],
title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[1]],
title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[1]]
) %>%
map(., ~{
write.xlsx(x = .x$results,
file = "03_RESULTS//02_K-means//CLUSTERS_DIFF_AMONG_GROUPS.xslx",
sheetName = paste0(.x$title.save))
})
# > Results from variance analyses (difference among clusters)
list(
title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]],
title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[1]],
title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[1]],
title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[1]],
title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[1]],
title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[1]],
title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[1]],
title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[1]]
) %>%
map(., ~{
.x$results})
# > Results from variance analyses (difference among clusters)
list(
list(title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]]),
list(title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[1]]),
list(title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[1]]),
list(title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[1]]),
list(title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[1]]),
list(title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[1]])
) %>%
map(., ~{
.x$results
write.xlsx(x = .x$results,
file = "03_RESULTS//02_K-means//CLUSTERS_DIFF_AMONG_GROUPS.xslx",
sheetName = paste0(.x$title.save))
})
# > Results from variance analyses (difference among clusters)
list(
list(title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]]),
list(title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[1]]),
list(title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[1]]),
list(title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[1]]),
list(title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[1]]),
list(title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[1]])
) %>%
map(., ~{
.x$results
write.xlsx(x = .x$results,
file = "03_RESULTS//02_K-means//CLUSTERS_DIFF_AMONG_GROUPS.xlsx",
sheetName = paste0(.x$title.save))
})
# > Results from variance analyses (difference among clusters)
list(
list(title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]]),
list(title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[1]]),
list(title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[1]]),
list(title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[1]]),
list(title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[1]]),
list(title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[1]])
) %>%
map(., ~{
.x$results
write.xlsx(x = .x$results,
file = "03_RESULTS//02_K-means//CLUSTERS//CLUSTERS_DIFF_AMONG_GROUPS.xlsx",
sheetName = paste0(.x$title.save),
append = TRUE)
})
list(
list(title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]]),
list(title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[1]]),
list(title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[1]]),
list(title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[1]]),
list(title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[1]]),
list(title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[1]])
) %>%
map(., ~{
.x$results %>%
gather(key = "var", value = "value", -Cluster) %>%
# Merge with variable names to allow for merging dataframe from different analyses
left_join(tab.name %>% mutate(var = paste0("z_", var)), by = "var") %>%
dplyr::select(-var)
})
list(
list(title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]]))
) %>%
map(., ~{
.x$results
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>%
gather(key = "var", value = "value") %>%
# Merge with variable names to allow for merging dataframe from different analyses
left_join(tab.name %>% mutate(var = paste0("z_", var)), by = "var") %>%
dplyr::select(-var)
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>%
gather(key = "var", value = "value") %>%
# Merge with variable names to allow for merging dataframe from different analyses
left_join(tab.name, by = "var") %>%
dplyr::select(-var)
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>%
gather(key = "var", value = "value") %>%
# Merge with variable names to allow for merging dataframe from different analyses
left_join(tab.name, by = "var")
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>% left_join(tab.name, by = c("Feature" = "var")
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>% left_join(tab.name, by = c("Feature" = "var") )
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>%
left_join(tab.name %>%
dplyr::rename("Feature" = "var"),
by = "Feature")
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>% left_join(tab.name, by = c("Feature" = "var") ) %>%
select(-Feature) %>%
dplyr::rename("Feature" = "var") %>%
select(Feature, starts_with("Cluster"), p.aov)
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>% left_join(tab.name, by = c("Feature" = "var") ) %>%
select(-Feature) %>%
dplyr::rename("Feature" = "var") %>%
dplyr::select(Feature, starts_with("Cluster"), p.aov)
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>% left_join(tab.name, by = c("Feature" = "var") ) %>%
select(-Feature) %>%
dplyr::rename("Feature" = "var")
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>% left_join(tab.name, by = c("Feature" = "var") ) %>%
dplyr::select(-Feature) %>%
dplyr::rename("Feature" = "var") %>%
dplyr::select(Feature, starts_with("Cluster"), p.aov)
})
list(list(title.save = "01_wei_log",results = wei_log_k_means_comp[[1]])) %>%
map(., ~{
.x$results %>% left_join(tab.name, by = c("Feature" = "var") )
})
# -----------------------------
# Table with PA features name
source("00_DATA\\00_tab-name_PA_features.R")
# > Results from variance analyses (difference among clusters)
list(
list(title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]]),
list(title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[1]]),
list(title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[1]]),
list(title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[1]]),
list(title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[1]]),
list(title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[1]])
) %>%
map(., ~{
# Formatting tables
tab.save <- .x$results %>% left_join(tab.name, by = c("Feature" = "var") ) %>%
dplyr::select(-Feature) %>%
dplyr::rename("Feature" = "var") %>%
dplyr::select(Feature, starts_with("Cluster"), p.aov)
# Save results in one Excel file
write.xlsx(x = tab.save,
file = "03_RESULTS//02_K-means//CLUSTERS//CLUSTERS_DIFF_AMONG_GROUPS.xlsx",
sheetName = paste0(.x$title.save),
append = TRUE)
})
tab.name
# > Results from variance analyses (difference among clusters)
list(
list(title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]]),
list(title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[1]]),
list(title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[1]]),
list(title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[1]]),
list(title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[1]]),
list(title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[1]])
) %>%
map(., ~{
# Formatting tables
tab.save <- .x$results %>% left_join(tab.name, by = c("Feature" = "var") ) %>%
dplyr::select(-Feature) %>%
dplyr::rename("Feature" = "varname") %>%
dplyr::select(Feature, starts_with("Cluster"), p.aov)
# Save results in one Excel file
write.xlsx(x = tab.save,
file = "03_RESULTS//02_K-means//CLUSTERS//CLUSTERS_DIFF_AMONG_GROUPS.xlsx",
sheetName = paste0(.x$title.save),
append = TRUE)
})
# > Results from variance analyses (difference among clusters)
list(
list(title.save = "01_wei_log",         results = wei_log_k_means_comp[[1]]),
list(title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[1]]),
list(title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[1]]),
list(title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[1]]),
list(title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[1]]),
list(title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[1]]),
list(title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[1]])
) %>%
map(., ~{
# Formatting tables
tab.save <- .x$results %>% left_join(tab.name, by = c("Feature" = "var") ) %>%
dplyr::select(-Feature) %>%
dplyr::rename("Feature" = "varname") %>%
dplyr::select(Feature, starts_with("Cluster"), p.aov)
# Save results in one Excel file
write.xlsx(x = tab.save,
file = "03_RESULTS//02_K-means//CLUSTERS//CLUSTERS_DIFF_AMONG_GROUPS.xlsx",
sheetName = paste0(.x$title.save),
append = TRUE)
})
# > Results from multiple groups comparison (difference between clusters)
list(
list(title.save = "01_wei_log",         results = wei_log_k_means_comp[[2]],         raw.data = data_wei_log),
list(title.save = "01_wei_sqrt",        results = wei_sqrt_k_means_comp[[2]],        raw.data = data_wei_sqrt),
list(title.save = "02_WD_WE_log",       results = WD_WE_log_k_means_comp[[2]],       raw.data = data_WD_WE_log),
list(title.save = "02_WD_WE_sqrt",      results = WD_WE_sqrt_k_means_comp[[2]],      raw.data = data_WD_WE_sqrt),
list(title.save = "03_wei_full_log",    results = wei_full_log_k_means_comp[[2]],    raw.data = data_wei_full_log),
list(title.save = "03_wei_full_sqrt",   results = wei_full_sqrt_k_means_comp[[2]],   raw.data = data_wei_full_sqrt),
list(title.save = "04_WD_WE_full_log",  results = WD_WE_full_log_k_means_comp[[2]],  raw.data = data_WD_WE_full_log),
list(title.save = "04_WD_WE_full_sqrt", results = WD_WE_full_sqrt_k_means_comp[[2]], raw.data = data_WD_WE_full_sqrt)
) %>%
map(., ~ {
# > Variable distribution between clusters
plot <- .x$raw.data %>%
dplyr::select(-km.5) %>%
gather(key = "variable", value = "value", -stno) %>%
group_by(variable) %>%
summarise(med = median(value),
IQR1 = quantile(value, 0.25),
IQR3 = quantile(value, 0.75)) %>%
ggplot(.) +
geom_hline(aes(yintercept = med), linetype = 2, col = "black") +
geom_hline(aes(yintercept = IQR1), linetype = 2, col = "darkgrey") +
geom_hline(aes(yintercept = IQR3), linetype = 2, col = "darkgrey") +
geom_jitter(data = .x$raw.data %>%
dplyr::select(-stno) %>%
gather(key = "variable", value = "value", -km.5),
aes(x = km.5, y = value, col = as.factor(km.5)),
alpha = 0.5, size = 0.1, pch = 1, width = 0.25) +
geom_point(data =  plyr::ldply(.x$results, data.frame, .id = "Feature") %>%
dplyr::rename("variable" = "Feature"),
aes(x = Group.1, y = x.mean)) +
geom_linerange(data =  plyr::ldply(.x$results, data.frame, .id = "Feature") %>%
dplyr::rename("variable" = "Feature"),
aes(x = Group.1, ymin = x.mean-x.sd, ymax = x.mean+x.sd)) +
geom_text(data = plyr::ldply(.x$results, data.frame, .id = "Feature") %>%
dplyr::rename("variable" = "Feature"),
aes(x = Group.1, y = x.mean+x.sd*2, label = letters),
size = 3) +
facet_wrap(. ~ variable, scales = "free") +
scale_color_manual(values = pal) +
scale_fill_manual(values = pal) +
theme_bw() +
theme(legend.position = "none",
strip.background = element_blank(),
axis.title = element_blank()) +
coord_flip()
# > Save the plot
ggsave(plot,
filename = paste0("03_RESULTS//02_K-means//CLUSTERS//DIFF_BETWEEN_CLUSTERS//", .x$title.save, ".png"),
device = png(),
width = 10, height = 6,
dpi = 300)
})
